var Adapter = require('../lib/common/RedisAdapter');
var assert = require('assert');
var adapter = new Adapter();
suite('RedisAdapter', function(){
  setup(function(done){
    adapter.attach(done);
  });
  teardown(function(done){
    adapter.detach(done);
  });
  test('Simple test', function(next){
    var values = [1,'a',null,undefined,3.14];
    var count = 0;
    adapter.on('stest', function(value){
      assert.equal(values[count], value, 'Emit value equals at index'+count);
      count ++;
      if ( count == values.length ) {
        next();
      }
    });
    for ( var i = 0; i < values.length; ++i ) {
      adapter.emit('stest', values[i], function(index, value){
      //  console.log('Emitted '+value);
      }.bind(null, i, values[i]));
    }
  });
});
