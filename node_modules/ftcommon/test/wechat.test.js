var assert = require('assert');
var lib = require('../index');
var co = require('co');
var thunkify = require('thunkify');
var WXAPI = lib.wechat;
var config = {
  id: 'wxcc3f95f9e8ee7c91',
  secret: '47d5f443f335085631ecf15adc8d493e'
}
var myopenid = 'ox6ygsxEZY82vcoViTmWQr9YdTQo';
var template_id = 'SEyOYH3Zh3DLbKcXpgxBcGzHf3Q3Lmys2fhEz4ADBN8';
var data = {
  "program": {
    "value": "中国好声音第四期",
    "color": "#173177"
  },
  "event": {
    "value": "摇奖马上开始了",
    "color": "#173177"
  },
  "start": {
    "value": "18:00 PM",
    "color": "#173177"
  },
  "duration": {
    "value": "120秒",
    "color": "#173177"
  },
  "remark": {
    "value": "点击详情可立即参与",
    "color": "#173177"
  }
};
var wxapi = new WXAPI(config);
// var token;
suite('wechat API testing', function() {
  suiteSetup(function(done) {
    /*wxapi.requestAccessToken(function(err, result) {
      if ( !err ) {
        token = result.access_token;
      }
      console.log(err, token);
      done(err);
    }); */
    done();
  });
  suiteTeardown(function(done) {
    done();
  });
  test('Template message fetch template test', function(next) {
    co(function*() {
      /*var url = 'https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=' + token;
      var result = yield thunkify(wxapi.wxJSONRequest.bind(wxapi))(url, {
        touser: myopenid,
        template_id: template_id,
        url: 'http://www.zhongledp.tv',
        data: data
      });
      console.log(JSON.stringify(result)); */
      var result = yield thunkify(wxapi.sendTemplateMessage.bind(wxapi))({
        openid: myopenid,
        template: template_id,
        url: 'http://www.zhongledp.tv',
        data: data
      });
      next();
    }).catch(function(err){
      console.error(err);
      next(err);
    });
  });
});
